<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Encrypted Notes Manager — Frontend</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --glass: rgba(255,255,255,0.04);
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --accent-2:#60a5fa;
      --accent-dark:#10b981;
      --danger:#fb7185;
      --radius:12px;
      --shadow: 0 6px 18px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(600px 400px at 10% 10%, rgba(96,165,250,0.06), transparent 10%),
        radial-gradient(600px 400px at 90% 90%, rgba(110,231,183,0.04), transparent 10%),
        var(--bg);
      color:#e6eef8;
      padding:28px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .app{
      max-width:1100px;
      margin:0 auto;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:22px;
    }
    .title{
      display:flex;
      gap:14px;
      align-items:center;
    }
    .logo{
      width:56px;height:56px;
      border-radius:12px;
      display:grid;place-items:center;
      background:linear-gradient(135deg,var(--accent-2),var(--accent));
      box-shadow: 0 6px 24px rgba(59,130,246,0.14);
      font-weight:700;color:#022;
      font-size:20px;
    }
    h1{margin:0;font-size:20px;letter-spacing:-0.2px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      padding:18px;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }

    .form{
      display:grid;
      gap:8px;
    }
    input[type="text"], textarea{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.04);
      color:inherit;
      padding:12px 14px;
      border-radius:10px;
      outline:none;
      transition:box-shadow .14s, transform .08s;
      font-size:14px;
    }
    input[type="text"]:focus, textarea:focus{
      box-shadow:0 6px 18px rgba(96,165,250,0.08);
      transform:translateY(-1px);
      border-color: rgba(96,165,250,0.35);
    }
    textarea{resize:vertical;min-height:120px;max-height:300px}

    .row{
      display:flex;gap:8px;align-items:center;
    }
    .btn{
      appearance:none;
      border:0;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:#042024;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      box-shadow:0 8px 24px rgba(110,231,183,0.08);
    }
    .btn.ghost{
      background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);
      box-shadow:none;font-weight:600;
    }
    .btn.danger{
      background:linear-gradient(90deg,#ff9aa2,#fb7185);
      color:#2b0210;
    }

    main{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:20px;
      margin-top:18px;
    }

    @media (max-width:920px){
      main{grid-template-columns:1fr}
    }

    .notes-grid{
      display:grid;
      gap:12px;
      grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
    }

    .note{
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 6px 20px rgba(2,6,23,0.45);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:110px;
    }
    .note .meta{display:flex;justify-content:space-between;align-items:center;gap:8px;color:var(--muted);font-size:12px}
    .note .title{font-weight:700;font-size:15px;line-height:1.2}
    .note .excerpt{color:var(--muted);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .note .actions{display:flex;gap:8px;margin-top:auto}

    .small{
      font-size:12px;color:var(--muted)
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:linear-gradient(0deg, rgba(2,6,23,0.6), rgba(2,6,23,0.6));
      z-index:60;padding:18px;
    }
    .modal{
      background:linear-gradient(180deg,#051022,#061428);
      border-radius:14px;padding:18px;max-width:820px;width:100%;
      border:1px solid rgba(255,255,255,0.04);
      box-shadow:0 20px 60px rgba(2,6,23,0.7);
    }
    .modal .modal-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .modal .modal-body{margin-top:12px;color:#dbeafe;white-space:pre-wrap;line-height:1.5}
    .close{
      background:transparent;border:0;color:var(--muted);font-weight:700;cursor:pointer;padding:6px 8px;border-radius:8px;
    }

    footer{margin-top:22px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <div class="logo">EN</div>
        <div>
          <h1>Encrypted Notes Manager</h1>
          <p class="lead">Simpan catatan Anda dengan desain yang modern</p>
        </div>
      </div>
      <div class="controls">
        <button class="btn ghost" onclick="fetchNotes()">Refresh</button>
        <button class="btn" onclick="document.getElementById('title').focus()">New Note</button>
      </div>
    </header>

    <main>
      <section>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
          <h3 style="margin:0">Notes</h3>
          <div class="small" id="count">—</div>
        </div>
        <div id="notes" class="notes-grid"></div>
      </section>

      <aside>
        <div class="panel">
          <h3 style="margin:0 0 8px 0">Buat Note</h3>
          <div class="form">
            <input id="title" type="text" placeholder="Judul" />
            <textarea id="content" placeholder="Isi catatan..."></textarea>
            <div class="row">
              <button class="btn" onclick="createNote()">Create</button>
              <button class="btn ghost" onclick="document.getElementById('title').value='';document.getElementById('content').value=''">Clear</button>
            </div>
            <div class="small" style="margin-top:8px;color:var(--muted)">Catatan disimpan ke server</div>
          </div>
        </div>
      </aside>
    </main>

    <div class="modal-backdrop" id="modal" role="dialog" aria-hidden="true">
      <div class="modal" role="document">
        <div class="modal-header">
          <div>
            <div id="modal-title" style="font-weight:700;font-size:16px"></div>
            <div class="small" id="modal-meta"></div>
          </div>
          <div>
            <button class="close" onclick="closeModal()">Close</button>
          </div>
        </div>
        <div class="modal-body" id="modal-body"></div>
      </div>
    </div>

    <footer>Tugas 1 Kriptografi.</footer>
  </div>

  <script>
    async function fetchNotes(){
      try{
        const res = await fetch('/notes');
        if(!res.ok) throw new Error('fetch failed');
        const data = await res.json();
        const container = document.getElementById('notes');
        container.innerHTML = '';
        document.getElementById('count').innerText = data.length + ' note' + (data.length !== 1 ? 's' : '');
        for(const n of data){
          const el = document.createElement('div'); el.className = 'note';
          const excerpt = (n.content || '').replace(/\n/g,' ').slice(0,120);
          el.innerHTML = `
            <div class="meta"><div class="title">${escapeHtml(n.title || 'Untitled')}</div><div class="small">id: ${n.id}</div></div>
            <div class="excerpt">${escapeHtml(excerpt)}</div>
            <div class="meta"><div class="small">${n.created_at || ''}</div><div></div></div>
            <div class="actions">
              <button class="btn ghost" onclick="viewNote(${n.id})">View</button>
              <button class="btn danger" onclick="deleteNote(${n.id})">Delete</button>
            </div>
          `;
          container.appendChild(el);
        }
      }catch(e){
        console.error(e);
        alert('Gagal memuat notes');
      }
    }

    async function createNote(){
      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      if(!title && !content){ alert('Isi judul atau konten'); return; }
      try{
        const res = await fetch('/notes',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title,content})});
        if(!res.ok) throw new Error('create failed');
        document.getElementById('title').value='';document.getElementById('content').value='';
        fetchNotes();
      }catch(e){
        console.error(e); alert('Gagal membuat note');
      }
    }

    async function viewNote(id){
      try{
        const res = await fetch('/notes/'+id);
        if(!res.ok) throw new Error('fetch note failed');
        const n = await res.json();
        document.getElementById('modal-title').innerText = n.title || 'Untitled';
        document.getElementById('modal-meta').innerText = 'id: ' + n.id + ' • ' + (n.created_at || '');
        document.getElementById('modal-body').innerText = n.content || '';
        openModal();
      }catch(e){
        console.error(e); alert('Gagal memuat note');
      }
    }

    async function deleteNote(id){
      if(!confirm('Delete note '+id+'?')) return;
      try{
        const res = await fetch('/notes/'+id,{method:'DELETE'});
        if(!res.ok) throw new Error('delete failed');
        fetchNotes();
      }catch(e){
        console.error(e); alert('Gagal menghapus note');
      }
    }

    function openModal(){
      const m = document.getElementById('modal');
      m.style.display = 'flex';
      m.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      const m = document.getElementById('modal');
      m.style.display = 'none';
      m.setAttribute('aria-hidden','true');
    }

    
    function escapeHtml(s){
      return String(s || '').replace(/[&<>"']/g, function(c){
        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c];
      });
    }

    // init
    fetchNotes();
  </script>
</body>
</html>
